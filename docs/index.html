 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bot3 Live TX Counter</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸ¤– Bot3: Live TX Counter</h1>
      <div class="hb">
        <div id="heartbeat" class="dot"></div>
        <div class="tps">TPS: <span id="tpsValue">1</span></div>
        <div id="status" class="badge">Running</div>
      </div>
    </header>

    <section class="counter-card">
      <div class="label">Total Transactions (builder)</div>
      <div id="txCount" class="counter">0</div>
      <div class="sub">Source: <span id="countSource">txCount.json</span> â€¢ Last update <span id="lastUpdate">â€“</span></div>
    </section>

    <footer>
      Hosted on GitHub Pages Â· Auto-refreshing dashboard
    </footer>
  </div>

  <script>
    const REFRESH_MS = 5000;
    let liveCount = 0, targetCount = 0, tps = 1;
    let lastTick = performance.now();

    function setHeartbeatSpeed(nextTps) {
      const dur = (1 / Math.max(0.2, Number(nextTps) || 1)).toFixed(3);
      document.documentElement.style.setProperty('--hb-duration', `${dur}s`);
      document.getElementById("tpsValue").textContent = nextTps;
    }

    function animate(now) {
      const dt = (now - lastTick) / 1000;
      lastTick = now;
      const step = tps * dt;
      if (liveCount < targetCount) liveCount = Math.min(targetCount, liveCount + step);
      document.getElementById("txCount").textContent = Math.floor(liveCount).toLocaleString();
      requestAnimationFrame(animate);
    }

    async function loadTxCount() {
      try {
        const res = await fetch("txCount.json", { cache: "no-store" });
        const j = await res.json();
        const total = Number(j.total ?? j.count ?? 0);
        targetCount = Math.max(targetCount, total);
        tps = Number(j.tps ?? 1);
        setHeartbeatSpeed(tps);
        document.getElementById("status").textContent = j.status ?? "Running";
        document.getElementById("lastUpdate").textContent = new Date(j.updatedAt ?? Date.now()).toLocaleTimeString();
      } catch (e) {
        console.warn(e);
      }
    }

    loadTxCount();
    setInterval(loadTxCount, REFRESH_MS);
    requestAnimationFrame(animate);
  </script>
</body>
</html>
